<?php
/**
 * Copyright Â© 2013-2017 Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

// @codingStandardsIgnoreFile

?>
<?php
    $types = $block->getTypes();
    $_helper = $this->helper('MGS\InstantSearch\Helper\Data');
    $_helper2 = $this->helper('Magento\Catalog\Helper\Output');

    $themeHelper = $this->helper('MGS\Mpanel\Helper\Data');
    $lazyLoad = $themeHelper->getStoreConfig('mgstheme/general/lazy_load');
    $baseImage = $this->getViewFileUrl('MGS_Mpanel::images/blank.png');
    $settings = $themeHelper->getThemeSettings();
    $perrow = $settings['catalog']['per_row'];
    $_imagehelper = $this->helper('Magento\Catalog\Helper\Image');
    $size = $themeHelper->getImageSize();
    $padding = $themeHelper->getImagePadding();
?>
<?php if (count($types) && $block->getResultCount()): ?>
<div class="search results mgs-instant-search">
    <?php if ($messages = $block->getNoteMessages()):?>
    <div class="message notice">
        <div>
            <?php foreach ($messages as $message):?>
                <?php /* @escapeNotVerified */ echo $message?><br />
            <?php endforeach;?>
        </div>
    </div>
    <?php endif; ?>
    <?php foreach ($types as $_type) : ?>
        <?php
            switch ($_type['type']) {
                case 'product':
                    if($_helper->isProductSearch()){
                        echo $block->getProductListHtml();
                    }
                    break;
                case 'category':
                    if($_helper->isCategorySearch()){
                        echo $block->getCategoryListHtml();
                    }
                    break;
                case 'page':
                    if($_helper->isCmsPageSearch()){
                        echo $block->getPageListHtml();
                    }
                    break;
                case 'blog':
                    if($_helper->isModuleEnabled('MGS_Blog') && $_helper->isBlogSearch()){
                        echo $block->getBlogListHtml();
                    }
                    break;
            }
        ?>
    <?php endforeach; ?>
</div>
<?php else: ?>

<div class="message notice">
    <div>
        <?php /* @escapeNotVerified */ echo($block->getNoResultText()) ? $block->getNoResultText() : __('Your search returned no results.') ?>
        <?php if ($messages = $block->getNoteMessages()):?>
            <?php foreach ($messages as $message):?>
                <br /><?php /* @escapeNotVerified */ echo $message?>
            <?php endforeach;?>
        <?php endif; ?>
    </div>
    <?php
    $viewMode = 'grid';
    $imageDisplayArea = 'category_page_grid';
    $templateType = \Magento\Catalog\Block\Product\ReviewRendererInterface::SHORT_VIEW;
    /**
     * Position for actions regarding image size changing in vde if needed
     */
    $pos = $block->getPositioned();
    $colCheck = $themeHelper->convertPerRowtoCol($perrow);
    $colClass = $themeHelper->convertColClass($colCheck, 'col');

    ?>
    <br><br>
    <ol class="content-block category-product-cat-block products-grid">
        <div class="content-heading">
            <h3 class="title">Quizas te pueda interesar</h3>
        </div>
        <li class="products wrapper <?php /* @escapeNotVerified */ echo $viewMode; ?> products-<?php /* @escapeNotVerified */ echo $viewMode; ?>">
            <ol class="products list items product-items row">
                <?php
                /** @var \MGS\InstantSearch\ViewModel\TopProducts $viewModel */
                $blockProduct= $block->getLayout()->createBlock('Magento\Catalog\Block\Product\AbstractProduct');
                $viewModel = $block->getViewModel();
                $postArray = $viewModel->getPostData();
                $i=0;
                foreach ($postArray as $_product){
                    $_product = $viewModel->getProduct($_product->getId());
                    $i++;
                    ?>
                    <li class="item product product-item <?php echo $colClass ?> <?php echo $themeHelper->getClearClass($perrow, $i) ?>">
                        <div class="product-item-info" data-container="product-grid">
                            <?php $image = 'category_page_grid'; ?>
                            <?php $_productNameStripped = $block->stripTags($_product->getName(), null, true); ?>
                            <?php $productImage = $_imagehelper->init($_product, $image)->resize($size['width'], $size['height'])->getUrl(); ?>
                            <?php if(!$lazyLoad): ?>
                                <?php $baseImage = $productImage ?>
                            <?php endif ?>
                            <?php // Product Image ?>
                            <div class="product-top">
                                <a href="<?php /* @escapeNotVerified */ echo $_product->getProductUrl() ?>" class="product photo product-item-photo"  style="padding-bottom: <?php echo $padding; ?>;" tabindex="-1">
                                    <img src="<?php echo $baseImage ?>" alt="<?php echo $_productNameStripped ?>" class="img-responsive product-image-photo img-thumbnail<?php if($lazyLoad): ?> lazy<?php endif ?>" data-src="<?php echo $productImage ?>"/>
                                </a>
                                <?php echo $themeHelper->getProductLabel($_product) ?>
                            </div>
                            <div class="product details product-item-details">
                                <?php
                                $_productNameStripped = $block->stripTags($_product->getName(), null, true);
                                ?>
                                <h5 class="product name product-item-name">
                                    <a class="product-item-link"
                                       href="<?php /* @escapeNotVerified */ echo $_product->getProductUrl() ?>">
                                        <?php /* @escapeNotVerified */ echo $_helper2->productAttribute($_product, $_product->getName(), 'name'); ?>
                                    </a>
                                </h5>

                                <?php /* @escapeNotVerified */ echo $block->getProductPrice($_product) ?>
                                <div class="price-box price-final_price" data-role="priceBox" data-product-id="<?php /* @escapeNotVerified */ echo $_product->getId() ?>" data-price-box="product-id-<?php /* @escapeNotVerified */ echo $_product->getId() ?>">
                                <span class="normal-price">
                                    <span class="price-container price-final_price tax weee">
                                        <span class="price-label">Desde</span>
                                        <span id="product-price-<?php /* @escapeNotVerified */ echo $_product->getId() ?>" data-price-amount="<?php echo $_product->getPrice(); ?>" data-price-type="finalPrice" class="price-wrapper ">
                                            <span class="price">$<?php echo number_format(round($_product->getFinalPrice(),0),0,',','.'); ?></span>
                                        </span>
                                    </span>
                                </span>
                                </div>
                                <div class="swatch-opt-<?php /* @escapeNotVerified */ echo $_product->getId() ?>" data-role="swatch-option-<?php /* @escapeNotVerified */ echo $_product->getId() ?>"></div>
                            </div>
                        </div>
                    </li>
                    <?php
                }
                ?>
            </ol>
        </li>
    </ol>
</div>
<?php endif; ?>
